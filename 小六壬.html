<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小六壬占卜工具 - 连数起课法</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #2d3748;
            overflow-x: hidden;
        }

        .glassmorphism {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px 0 rgba(31, 38, 135, 0.2);
        }

        .highlight-text {
            position: relative;
            display: inline-block;
        }

        .highlight-text::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background-color: rgba(99, 102, 241, 0.2);
            z-index: -1;
        }

        .result-card {
            transition: all 0.3s ease;
            border-radius: 12px;
            overflow: hidden;
        }

        .result-card:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .input-field {
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .btn-submit {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            transition: all 0.3s ease;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.5);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        .shadow-glow {
            box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.5);
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.3), transparent);
        }

        .animated-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255, 105, 180, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(79, 70, 229, 0.05) 0%, transparent 50%);
        }
        
        .method-step {
            transition: all 0.3s ease;
        }
        
        .method-step:hover {
            background-color: rgba(99, 102, 241, 0.05);
            transform: translateX(5px);
        }
        
        .analysis-section {
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .analysis-section:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .hexagram-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto;
        }
        
        .hexagram-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background-color: rgba(79, 70, 229, 0.7);
            left: 0;
        }
        
        .hexagram-line:nth-child(1) { top: 20%; }
        .hexagram-line:nth-child(2) { top: 40%; }
        .hexagram-line:nth-child(3) { top: 60%; }
        .hexagram-line:nth-child(4) { top: 80%; }
        
        .hexagram-dot {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(79, 70, 229, 1);
        }
        
        .hexagram-dot:nth-child(1) { top: 20%; left: 30%; }
        .hexagram-dot:nth-child(2) { top: 20%; left: 70%; }
        .hexagram-dot:nth-child(3) { top: 40%; left: 30%; }
        .hexagram-dot:nth-child(4) { top: 40%; left: 70%; }
        .hexagram-dot:nth-child(5) { top: 60%; left: 30%; }
        .hexagram-dot:nth-child(6) { top: 60%; left: 70%; }
        .hexagram-dot:nth-child(7) { top: 80%; left: 30%; }
        .hexagram-dot:nth-child(8) { top: 80%; left: 70%; }
        
        .download-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(79, 70, 229, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 1000;
        }
        
        .download-notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .download-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-right: 16px;
        }
    </style>
</head>
<body class="min-h-screen relative">
    <div class="animated-bg"></div>

    <!-- 导航条 -->
    <nav class="glassmorphism sticky top-0 z-50 p-4 mb-8">
        <div class="container mx-auto flex items-center justify-between">
            <div class="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 text-transparent bg-clip-text">
                <i class="fas fa-chart-pie mr-2"></i>小六壬占卜工具
            </div>
        </div>
    </nav>

    <!-- 头部横幅 -->
    <header class="container mx-auto py-12 px-4 md:px-8 relative">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-3xl md:text-4xl font-bold mb-4">小六壬占卜工具</h1>
            <p class="text-lg text-gray-600 mb-8">采用连数起课法，帮助您洞察生活中的各种情况</p>
        </div>
    </header>

    <!-- 主要内容 -->
    <main class="container mx-auto py-8 px-4 md:px-8">
        <div class="glassmorphism p-8 mb-12">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 flex items-center justify-center text-white mr-3">
                    <i class="fas fa-info-circle"></i>
                </div>
                工具介绍
            </h2>
            <p class="text-gray-600 mb-4">小六壬是中国传统占卜术之一，本工具采用连数起课法进行占卜。六神顺序固定为：</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6">
                <div class="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-500">
                    <p class="font-semibold text-blue-700">大安（1）</p>
                    <p class="text-sm text-gray-600">静止吉祥，凡事可成</p>
                </div>
                <div class="bg-purple-50 rounded-lg p-4 border-l-4 border-purple-500">
                    <p class="font-semibold text-purple-700">留连（2）</p>
                    <p class="text-sm text-gray-600">拖延纠缠，办事不利</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4 border-l-4 border-green-500">
                    <p class="font-semibold text-green-700">速喜（3）</p>
                    <p class="text-sm text-gray-600">喜庆快速，吉事将至</p>
                </div>
                <div class="bg-red-50 rounded-lg p-4 border-l-4 border-red-500">
                    <p class="font-semibold text-red-700">赤口（4）</p>
                    <p class="text-sm text-gray-600">口舌凶险，需防是非</p>
                </div>
                <div class="bg-yellow-50 rounded-lg p-4 border-l-4 border-yellow-500">
                    <p class="font-semibold text-yellow-700">小吉（5）</p>
                    <p class="text-sm text-gray-600">和合吉利，运势顺畅</p>
                </div>
                <div class="bg-gray-50 rounded-lg p-4 border-l-4 border-gray-500">
                    <p class="font-semibold text-gray-700">空亡（6）</p>
                    <p class="text-sm text-gray-600">虚妄无果，谋事难成</p>
                </div>
            </div>
            
            <div class="mt-8">
                <h3 class="text-xl font-semibold mb-4">连数起课法步骤</h3>
                <div class="space-y-4">
                    <div class="method-step p-4 rounded-lg border border-gray-100">
                        <p class="font-medium">步骤1：</p>
                        <p class="text-gray-600">六神顺序固定为大安(1)、留连(2)、速喜(3)、赤口(4)、小吉(5)、空亡(6)</p>
                    </div>
                    <div class="method-step p-4 rounded-lg border border-gray-100">
                        <p class="font-medium">步骤2：</p>
                        <p class="text-gray-600">从大安开始，第一个数字n1从1数到n1确定第一落点</p>
                    </div>
                    <div class="method-step p-4 rounded-lg border border-gray-100">
                        <p class="font-medium">步骤3：</p>
                        <p class="text-gray-600">第二个数字n2从第一落点开始数n2确定第二落点</p>
                    </div>
                    <div class="method-step p-4 rounded-lg border border-gray-100">
                        <p class="font-medium">步骤4：</p>
                        <p class="text-gray-600">第三个数字n3从第二落点开始数n3确定第三落点</p>
                    </div>
                    <div class="method-step p-4 rounded-lg border border-gray-100">
                        <p class="font-medium">步骤5：</p>
                        <p class="text-gray-600">显示三个落点的神煞及含义，并根据问事内容给出综合分析</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 输入区域 -->
        <div class="glassmorphism p-8 mb-12">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 flex items-center justify-center text-white mr-3">
                    <i class="fas fa-calculator"></i>
                </div>
                占卜输入
            </h2>
            
            <form id="divinationForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="space-y-2">
                        <label for="num1" class="block text-sm font-medium text-gray-700">第一个数字 (1-12)</label>
                        <input type="number" id="num1" name="num1" min="1" max="12" class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="输入1-12之间的整数" required>
                        <p id="error1" class="text-red-500 text-xs hidden">请输入1-12之间的整数</p>
                    </div>
                    <div class="space-y-2">
                        <label for="num2" class="block text-sm font-medium text-gray-700">第二个数字 (1-12)</label>
                        <input type="number" id="num2" name="num2" min="1" max="12" class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="输入1-12之间的整数" required>
                        <p id="error2" class="text-red-500 text-xs hidden">请输入1-12之间的整数</p>
                    </div>
                    <div class="space-y-2">
                        <label for="num3" class="block text-sm font-medium text-gray-700">第三个数字 (1-12)</label>
                        <input type="number" id="num3" name="num3" min="1" max="12" class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="输入1-12之间的整数" required>
                        <p id="error3" class="text-red-500 text-xs hidden">请输入1-12之间的整数</p>
                    </div>
                </div>
                
                <!-- 新增问事内容输入框 -->
                <div class="space-y-2">
                    <label for="question" class="block text-sm font-medium text-gray-700">问事内容</label>
                    <textarea id="question" name="question" rows="3" class="input-field w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="请输入您想询问的事情，如："近期财运如何？"、"感情发展状况"等" required></textarea>
                    <p id="errorQuestion" class="text-red-500 text-xs hidden">请输入问事内容</p>
                </div>
                
                <div class="flex justify-center">
                    <button type="submit" class="btn-submit text-white font-medium py-3 px-8 rounded-lg flex items-center">
                        <i class="fas fa-magic mr-2"></i>开始占卜
                    </button>
                </div>
            </form>
        </div>

        <!-- 结果显示区域 -->
        <div id="resultArea" class="glassmorphism p-8 hidden">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 flex items-center justify-center text-white mr-3">
                    <i class="fas fa-scroll"></i>
                </div>
                占卜结果
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div id="result1" class="result-card p-6 flex flex-col items-center justify-center text-center">
                    <div class="w-16 h-16 rounded-full flex items-center justify-center mb-4 text-white text-xl font-bold"></div>
                    <h3 class="text-xl font-bold mb-2"></h3>
                    <p class="text-gray-600"></p>
                </div>
                <div id="result2" class="result-card p-6 flex flex-col items-center justify-center text-center">
                    <div class="w-16 h-16 rounded-full flex items-center justify-center mb-4 text-white text-xl font-bold"></div>
                    <h3 class="text-xl font-bold mb-2"></h3>
                    <p class="text-gray-600"></p>
                </div>
                <div id="result3" class="result-card p-6 flex flex-col items-center justify-center text-center">
                    <div class="w-16 h-16 rounded-full flex items-center justify-center mb-4 text-white text-xl font-bold"></div>
                    <h3 class="text-xl font-bold mb-2"></h3>
                    <p class="text-gray-600"></p>
                </div>
            </div>
            
            <div class="divider my-6"></div>
            
            <!-- 新增综合分析板块 -->
            <div id="analysisSection" class="analysis-section bg-gradient-to-br from-indigo-50 to-purple-50 p-6 rounded-xl mb-8">
                <h3 class="text-xl font-bold mb-4 text-indigo-700 flex items-center">
                    <i class="fas fa-book-open mr-2"></i>综合分析
                </h3>
                
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="md:w-1/4 flex justify-center items-center">
                        <div class="hexagram-container">
                            <div class="hexagram-line"></div>
                            <div class="hexagram-line"></div>
                            <div class="hexagram-line"></div>
                            <div class="hexagram-line"></div>
                            <div class="hexagram-dot"></div>
                            <div class="hexagram-dot"></div>
                            <div class="hexagram-dot"></div>
                            <div class="hexagram-dot"></div>
                            <div class="hexagram-dot"></div>
                            <div class="hexagram-dot"></div>
                            <div class="hexagram-dot"></div>
                            <div class="hexagram-dot"></div>
                        </div>
                    </div>
                    
                    <div class="md:w-3/4">
                        <div class="mb-4">
                            <p class="font-medium text-gray-700">问事内容：</p>
                            <p id="displayQuestion" class="text-gray-600 mt-1"></p>
                        </div>
                        
                        <div class="mb-4">
                            <p class="font-medium text-gray-700">六神组合：</p>
                            <p id="combinationText" class="text-gray-600 mt-1"></p>
                        </div>
                        
                        <div class="mb-4">
                            <p class="font-medium text-gray-700">吉凶判断：</p>
                            <p id="fortuneResult" class="text-gray-600 mt-1"></p>
                        </div>
                        
                        <div>
                            <p class="font-medium text-gray-700">建议：</p>
                            <p id="adviceText" class="text-gray-600 mt-1"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button id="resetButton" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-2 px-6 rounded-lg transition-colors">
                    <i class="fas fa-redo-alt mr-2"></i>重新占卜
                </button>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="container mx-auto py-8 px-4 md:px-8 mt-12">
        <div class="divider mb-6"></div>
        <div class="text-center text-gray-500 text-sm">
            <p>created by <a href="https://space.coze.cn" class="text-indigo-600 hover:underline">coze space</a></p>
            <p class="mt-2">页面内容均由 AI 生成，仅供参考</p>
        </div>
    </footer>
    
    <!-- 下载通知 -->
    <div id="downloadNotification" class="download-notification">
        <div class="download-icon">
            <i class="fas fa-file-download text-xl"></i>
        </div>
        <div>
            <p class="font-medium text-gray-800">测算结果已导出</p>
            <p class="text-sm text-gray-600">文件已自动下载到您的设备</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 神煞数据
            const divinationData = {
                1: { name: '大安', meaning: '静止吉祥，凡事可成', color: 'bg-blue-500', bgColor: 'bg-blue-50', textColor: 'text-blue-700' },
                2: { name: '留连', meaning: '拖延纠缠，办事不利', color: 'bg-purple-500', bgColor: 'bg-purple-50', textColor: 'text-purple-700' },
                3: { name: '速喜', meaning: '喜庆快速，吉事将至', color: 'bg-green-500', bgColor: 'bg-green-50', textColor: 'text-green-700' },
                4: { name: '赤口', meaning: '口舌凶险，需防是非', color: 'bg-red-500', bgColor: 'bg-red-50', textColor: 'text-red-700' },
                5: { name: '小吉', meaning: '和合吉利，运势顺畅', color: 'bg-yellow-500', bgColor: 'bg-yellow-50', textColor: 'text-yellow-700' },
                6: { name: '空亡', meaning: '虚妄无果，谋事难成', color: 'bg-gray-500', bgColor: 'bg-gray-50', textColor: 'text-gray-700' }
            };
            
            // 六神组合规则库
            const combinationRules = {
                // 基础组合规则
                '大安+留连+速喜': {
                    summary: '大安主静，留连主迟，速喜主成',
                    fortune: '先静后动，虽有延迟但最终可成',
                    advice: '初时宜静不宜动，耐心等待时机，后期积极行动可获成功'
                },
                '大安+速喜+小吉': {
                    summary: '大安主吉，速喜主快，小吉主顺',
                    fortune: '大吉大利，诸事顺遂',
                    advice: '把握时机，积极行动，可获快速成功'
                },
                '留连+赤口+空亡': {
                    summary: '留连主滞，赤口主凶，空亡主虚',
                    fortune: '大凶之兆，诸事不利',
                    advice: '宜守不宜进，等待时机，避免冒险行动'
                },
                '速喜+小吉+大安': {
                    summary: '速喜主成，小吉主和，大安主稳',
                    fortune: '先成后稳，结果圆满',
                    advice: '前期积极推进，后期稳扎稳打，可保长久'
                },
                '赤口+空亡+留连': {
                    summary: '赤口主争，空亡主失，留连主延',
                    fortune: '多有争端，易失机会，进展缓慢',
                    advice: '避免与人争执，谨慎决策，耐心等待转机'
                },
                '小吉+大安+速喜': {
                    summary: '小吉主和，大安主静，速喜主成',
                    fortune: '和谐顺畅，静候佳音',
                    advice: '保持和谐人际关系，耐心等待，时机成熟自然成功'
                },
                '空亡+留连+赤口': {
                    summary: '空亡主虚，留连主滞，赤口主险',
                    fortune: '虚耗精力，进展受阻，险象环生',
                    advice: '不宜轻举妄动，保存实力，等待有利时机'
                },
                '大安+留连+赤口': {
                    summary: '大安主静，留连主迟，赤口主争',
                    fortune: '先静后争，多有阻碍',
                    advice: '初时宜静，避免争执，耐心等待转机'
                },
                '速喜+赤口+小吉': {
                    summary: '速喜主成，赤口主险，小吉主和',
                    fortune: '先成后险，终得和解',
                    advice: '取得初步成果后需谨慎行事，以和为贵'
                },
                '小吉+空亡+大安': {
                    summary: '小吉主和，空亡主失，大安主稳',
                    fortune: '先和后失，终得安稳',
                    advice: '保持和谐，面对得失泰然处之，最终会有安稳结果'
                }
            };
            
            // 基于问事类型的分析库
            const questionTypeAnalysis = {
                // 财运相关
                '财运': {
                    '大安': '财运稳定，适合稳健投资',
                    '留连': '财运迟滞，不宜冒险投资',
                    '速喜': '财运亨通，有意外之财',
                    '赤口': '财运有损，需防破财',
                    '小吉': '财运平顺，小财不断',
                    '空亡': '财运空虚，不宜投资'
                },
                // 感情相关
                '感情': {
                    '大安': '感情稳定，宜平稳发展',
                    '留连': '感情拖延，需主动推进',
                    '速喜': '感情进展迅速，吉事将近',
                    '赤口': '感情有口角，需谨慎处理',
                    '小吉': '感情和谐，相处愉快',
                    '空亡': '感情虚无，不宜强求'
                },
                // 事业相关
                '事业': {
                    '大安': '事业稳定，宜守不宜进',
                    '留连': '事业停滞，需耐心等待',
                    '速喜': '事业顺利，有晋升机会',
                    '赤口': '事业有阻碍，需防小人',
                    '小吉': '事业平顺，小有所成',
                    '空亡': '事业迷茫，需重新规划'
                },
                // 健康相关
                '健康': {
                    '大安': '身体健康，无大碍',
                    '留连': '身体虚弱，需调理',
                    '速喜': '身体康复，健康改善',
                    '赤口': '身体不适，需就医检查',
                    '小吉': '身体状况良好，精力充沛',
                    '空亡': '身体虚弱，需注意休息'
                },
                // 学业相关
                '学业': {
                    '大安': '学业稳定，基础扎实',
                    '留连': '学业进步缓慢，需加倍努力',
                    '速喜': '学业进步明显，考试顺利',
                    '赤口': '学业有阻碍，需克服困难',
                    '小吉': '学业平顺，成绩良好',
                    '空亡': '学业迷茫，需明确目标'
                }
            };

            // 表单提交处理
            const form = document.getElementById('divinationForm');
            const resultArea = document.getElementById('resultArea');
            const resetButton = document.getElementById('resetButton');
            const downloadNotification = document.getElementById('downloadNotification');

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 获取输入值
                const num1 = parseInt(document.getElementById('num1').value);
                const num2 = parseInt(document.getElementById('num2').value);
                const num3 = parseInt(document.getElementById('num3').value);
                const question = document.getElementById('question').value.trim();
                
                // 验证输入
                let isValid = true;
                
                if (isNaN(num1) || num1 < 1 || num1 > 12) {
                    document.getElementById('error1').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('error1').classList.add('hidden');
                }
                
                if (isNaN(num2) || num2 < 1 || num2 > 12) {
                    document.getElementById('error2').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('error2').classList.add('hidden');
                }
                
                if (isNaN(num3) || num3 < 1 || num3 > 12) {
                    document.getElementById('error3').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('error3').classList.add('hidden');
                }
                
                if (!question) {
                    document.getElementById('errorQuestion').classList.remove('hidden');
                    isValid = false;
                } else {
                    document.getElementById('errorQuestion').classList.add('hidden');
                }
                
                if (!isValid) return;
                
                // 计算落点（采用连数起课法）
                // 步骤1：六神顺序固定为大安(1)、留连(2)、速喜(3)、赤口(4)、小吉(5)、空亡(6)
                // 步骤2：从大安开始，第一个数字n1从1数到n1确定第一落点
                const position1 = calculatePosition(1, num1);
                // 步骤3：第二个数字n2从第一落点开始数n2确定第二落点
                const position2 = calculatePosition(position1, num2);
                // 步骤4：第三个数字n3从第二落点开始数n3确定第三落点
                const position3 = calculatePosition(position2, num3);
                
                // 显示结果
                displayResult(position1, position2, position3, question);
                
                // 显示结果区域
                resultArea.classList.remove('hidden');
                
                // 平滑滚动到结果区域
                resultArea.scrollIntoView({ behavior: 'smooth' });
                
                // 导出结果
                exportResult(num1, num2, num3, question, position1, position2, position3);
            });
            
            // 重置按钮事件
            resetButton.addEventListener('click', function() {
                form.reset();
                resultArea.classList.add('hidden');
                
                // 平滑滚动到表单区域
                form.scrollIntoView({ behavior: 'smooth' });
            });
            
            // 计算落点位置的函数（连数起课法）
            function calculatePosition(startPosition, steps) {
                // 六神循环：1->2->3->4->5->6->1->...
                // 从起始位置开始，数steps步（包括起始位置）
                const position = (startPosition + steps - 1 - 1) % 6 + 1;
                return position;
            }
            
            // 显示结果函数
            function displayResult(r1, r2, r3, question) {
                // 清除之前的结果样式
                clearResultStyles();
                
                // 设置第一个结果
                const result1 = document.getElementById('result1');
                result1.classList.add(divinationData[r1].bgColor);
                result1.querySelector('div').classList.add(divinationData[r1].color);
                result1.querySelector('div').textContent = r1;
                result1.querySelector('h3').classList.add(divinationData[r1].textColor);
                result1.querySelector('h3').textContent = divinationData[r1].name;
                result1.querySelector('p').textContent = divinationData[r1].meaning;
                
                // 设置第二个结果
                const result2 = document.getElementById('result2');
                result2.classList.add(divinationData[r2].bgColor);
                result2.querySelector('div').classList.add(divinationData[r2].color);
                result2.querySelector('div').textContent = r2;
                result2.querySelector('h3').classList.add(divinationData[r2].textColor);
                result2.querySelector('h3').textContent = divinationData[r2].name;
                result2.querySelector('p').textContent = divinationData[r2].meaning;
                
                // 设置第三个结果
                const result3 = document.getElementById('result3');
                result3.classList.add(divinationData[r3].bgColor);
                result3.querySelector('div').classList.add(divinationData[r3].color);
                result3.querySelector('div').textContent = r3;
                result3.querySelector('h3').classList.add(divinationData[r3].textColor);
                result3.querySelector('h3').textContent = divinationData[r3].name;
                result3.querySelector('p').textContent = divinationData[r3].meaning;
                
                // 设置综合分析
                setAnalysis(r1, r2, r3, question);
            }
            
            // 设置综合分析函数
            function setAnalysis(r1, r2, r3, question) {
                // 显示问事内容
                document.getElementById('displayQuestion').textContent = question;
                
                // 构建六神组合文本
                const combinationKey = `${divinationData[r1].name}+${divinationData[r2].name}+${divinationData[r3].name}`;
                document.getElementById('combinationText').textContent = combinationKey;
                
                // 获取六神组合规则
                let rule = combinationRules[combinationKey];
                
                // 如果没有特定组合规则，使用通用分析
                if (!rule) {
                    rule = generateGeneralAnalysis(r1, r2, r3);
                }
                
                // 根据问事内容类型调整分析结果
                const adjustedAnalysis = adjustAnalysisByQuestionType(rule, r1, r2, r3, question);
                
                // 显示分析结果
                document.getElementById('fortuneResult').textContent = adjustedAnalysis.fortune;
                document.getElementById('adviceText').textContent = adjustedAnalysis.advice;
                
                // 返回分析结果，用于导出
                return adjustedAnalysis;
            }
            
            // 生成通用分析函数
            function generateGeneralAnalysis(r1, r2, r3) {
                // 统计吉、凶神煞数量
                const goodPositions = [1, 3, 5]; // 大安、速喜、小吉为吉
                const badPositions = [2, 4, 6];  // 留连、赤口、空亡为凶
                
                let goodCount = 0;
                let badCount = 0;
                
                [r1, r2, r3].forEach(pos => {
                    if (goodPositions.includes(pos)) goodCount++;
                    if (badPositions.includes(pos)) badCount++;
                });
                
                // 根据吉、凶神煞数量生成分析
                let fortune = '';
                let advice = '';
                
                if (goodCount > badCount) {
                    fortune = '整体吉兆，虽有小阻但终可成';
                    advice = '把握有利时机，积极行动，同时注意防范小风险';
                } else if (badCount > goodCount) {
                    fortune = '整体凶兆，需谨慎行事';
                    advice = '宜守不宜进，等待时机，避免冒险行动';
                } else {
                    fortune = '吉凶参半，需灵活应对';
                    advice = '审时度势，灵活应变，见机行事';
                }
                
                return {
                    summary: `${divinationData[r1].name}主${divinationData[r1].meaning.split('，')[0]}，${divinationData[r2].name}主${divinationData[r2].meaning.split('，')[0]}，${divinationData[r3].name}主${divinationData[r3].meaning.split('，')[0]}`,
                    fortune: fortune,
                    advice: advice
                };
            }
            
            // 根据问事类型调整分析结果
            function adjustAnalysisByQuestionType(rule, r1, r2, r3, question) {
                // 复制原始规则，避免修改原对象
                const adjustedRule = { ...rule };
                
                // 检测问事类型
                let questionType = '';
                const lowerCaseQuestion = question.toLowerCase();
                
                for (const type in questionTypeAnalysis) {
                    if (lowerCaseQuestion.includes(type)) {
                        questionType = type;
                        break;
                    }
                }
                
                // 如果识别到问事类型，调整分析结果
                if (questionType && questionTypeAnalysis[questionType]) {
                    // 基于六神组合和问事类型生成更具体的建议
                    const specificAdvice = [];
                    
                    // 按顺序分析每个神煞对问事类型的影响
                    [r1, r2, r3].forEach((pos, index) => {
                        const godName = divinationData[pos].name;
                        specificAdvice.push(`${index === 0 ? '初期' : index === 1 ? '中期' : '后期'}${questionTypeAnalysis[questionType][godName]}`);
                    });
                    
                    // 结合原始建议和特定建议
                    adjustedRule.advice = `${rule.advice}。${questionType}方面：${specificAdvice.join('；')}。`;
                }
                
                return adjustedRule;
            }
            
            // 清除结果样式函数
            function clearResultStyles() {
                const resultCards = document.querySelectorAll('.result-card');
                const colors = ['bg-blue-500', 'bg-purple-500', 'bg-green-500', 'bg-red-500', 'bg-yellow-500', 'bg-gray-500'];
                const bgColors = ['bg-blue-50', 'bg-purple-50', 'bg-green-50', 'bg-red-50', 'bg-yellow-50', 'bg-gray-50'];
                const textColors = ['text-blue-700', 'text-purple-700', 'text-green-700', 'text-red-700', 'text-yellow-700', 'text-gray-700'];
                
                resultCards.forEach(card => {
                    // 移除背景颜色类
                    bgColors.forEach(color => card.classList.remove(color));
                    
                    // 移除数字圆圈颜色类
                    const circle = card.querySelector('div');
                    colors.forEach(color => circle.classList.remove(color));
                    
                    // 移除标题颜色类
                    const title = card.querySelector('h3');
                    textColors.forEach(color => title.classList.remove(color));
                });
            }
            
            // 输入框实时验证
            const inputs = form.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    const errorElement = document.getElementById(`error${this.id.charAt(this.id.length - 1)}`);
                    
                    if (isNaN(value) || value < 1 || value > 12) {
                        errorElement.classList.remove('hidden');
                    } else {
                        errorElement.classList.add('hidden');
                    }
                });
            });
            
            // 问事内容实时验证
            const questionInput = document.getElementById('question');
            questionInput.addEventListener('input', function() {
                const errorElement = document.getElementById('errorQuestion');
                
                if (!this.value.trim()) {
                    errorElement.classList.remove('hidden');
                } else {
                    errorElement.classList.add('hidden');
                }
            });
            
            // 导出结果函数
            function exportResult(num1, num2, num3, question, pos1, pos2, pos3) {
                // 获取当前日期时间，格式为YYYYMMDDHH
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hour = String(now.getHours()).padStart(2, '0');
                const timestamp = `${year}${month}${day}${hour}`;
                
                // 过滤文件名中的特殊字符
                const filteredQuestion = filterSpecialChars(question);
                
                // 生成文件名
                const prefix = filteredQuestion || '小六壬测算';
                const filename = `${prefix}${timestamp}.txt`;
                
                // 构建文件内容
                let fileContent = `===== 小六壬测算结果 =====\n\n`;
                fileContent += `问事内容：${question}\n\n`;
                fileContent += `输入数字：${num1}, ${num2}, ${num3}\n\n`;
                fileContent += `测算结果：\n`;
                fileContent += `1. ${divinationData[pos1].name} - ${divinationData[pos1].meaning}\n`;
                fileContent += `2. ${divinationData[pos2].name} - ${divinationData[pos2].meaning}\n`;
                fileContent += `3. ${divinationData[pos3].name} - ${divinationData[pos3].meaning}\n\n`;
                
                // 获取综合分析结果
                const analysis = setAnalysis(pos1, pos2, pos3, question);
                fileContent += `六神组合：${divinationData[pos1].name}+${divinationData[pos2].name}+${divinationData[pos3].name}\n\n`;
                fileContent += `综合分析：\n`;
                fileContent += `吉凶判断：${analysis.fortune}\n`;
                fileContent += `建议：${analysis.advice}\n\n`;
                fileContent += `===== 测算完成 =====\n`;
                fileContent += `测算时间：${year}-${month}-${day} ${hour}:${String(now.getMinutes()).padStart(2, '0')}\n`;
                
                // 创建Blob对象
                const blob = new Blob([fileContent], { type: 'text/plain;charset=utf-8' });
                
                // 创建下载链接
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                
                // 触发下载
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // 显示下载通知
                showDownloadNotification();
            }
            
            // 过滤文件名中的特殊字符
            function filterSpecialChars(str) {
                if (!str) return '';
                // 移除所有非中文字符、字母、数字、下划线、横线、空格
                return str.replace(/[^\u4e00-\u9fa5a-zA-Z0-9_\-\s]/g, '').trim();
            }
            
            // 显示下载通知
            function showDownloadNotification() {
                downloadNotification.classList.add('show');
                
                // 3秒后隐藏通知
                setTimeout(() => {
                    downloadNotification.classList.remove('show');
                }, 3000);
            }
        });
    </script>
</body>
</html>
